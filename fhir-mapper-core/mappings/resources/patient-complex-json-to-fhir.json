{
	"id": "patient-complex-json-to-fhir-v1",
	"name": "Complex Patient JSON to FHIR Mapping",
	"version": "1.0.0",
	"direction": "JSON_TO_FHIR",
	"sourceType": "ComplexPatientDTO",
	"targetType": "Patient",
	"fieldMappings": [
		{
			"id": "patient-mrn",
			"sourcePath": "patientId",
			"targetPath": "identifier[0].value",
			"dataType": "string",
			"required": true,
			"description": "Medical Record Number"
		},
		{
			"id": "patient-mrn-system",
			"sourcePath": null,
			"targetPath": "identifier[0].system",
			"dataType": "uri",
			"defaultValue": "$ctx.settings['mrnSystem']",
			"required": true
		},
		{
			"id": "patient-mrn-type-code",
			"sourcePath": null,
			"targetPath": "identifier[0].type.coding[0].code",
			"dataType": "code",
			"defaultValue": "MR",
			"required": true
		},
		{
			"id": "patient-mrn-type-system",
			"sourcePath": null,
			"targetPath": "identifier[0].type.coding[0].system",
			"dataType": "uri",
			"defaultValue": "http://terminology.hl7.org/CodeSystem/v2-0203",
			"required": true
		},
		{
			"id": "patient-ssn",
			"sourcePath": "ssn",
			"targetPath": "identifier[1].value",
			"dataType": "string",
			"transformExpression": "fn:replace(value, '-', '')",
			"condition": "ssn != null && ssn != ''",
			"required": false,
			"description": "SSN without dashes"
		},
		{
			"id": "patient-ssn-system",
			"sourcePath": null,
			"targetPath": "identifier[1].system",
			"dataType": "uri",
			"defaultValue": "http://hl7.org/fhir/sid/us-ssn",
			"condition": "ssn != null && ssn != ''",
			"required": false
		},
		{
			"id": "patient-ssn-type-code",
			"sourcePath": null,
			"targetPath": "identifier[1].type.coding[0].code",
			"dataType": "code",
			"defaultValue": "SS",
			"condition": "ssn != null && ssn != ''",
			"required": false
		},
		{
			"id": "patient-name-use",
			"sourcePath": null,
			"targetPath": "name[0].use",
			"dataType": "code",
			"defaultValue": "official",
			"required": true
		},
		{
			"id": "patient-name-family",
			"sourcePath": "lastName",
			"targetPath": "name[0].family",
			"dataType": "string",
			"required": true
		},
		{
			"id": "patient-name-given-first",
			"sourcePath": "firstName",
			"targetPath": "name[0].given[0]",
			"dataType": "string",
			"required": true
		},
		{
			"id": "patient-name-given-middle",
			"sourcePath": "middleName",
			"targetPath": "name[0].given[1]",
			"dataType": "string",
			"condition": "middleName != null && middleName != ''",
			"required": false
		},
		{
			"id": "patient-name-suffix",
			"sourcePath": "suffix",
			"targetPath": "name[0].suffix[0]",
			"dataType": "string",
			"condition": "suffix != null && suffix != ''",
			"required": false
		},
		{
			"id": "patient-gender",
			"sourcePath": "gender",
			"targetPath": "gender",
			"dataType": "code",
			"lookupTable": "gender-lookup",
			"required": true
		},
		{
			"id": "patient-birthdate",
			"sourcePath": "dateOfBirth",
			"targetPath": "birthDate",
			"dataType": "date",
			"required": false
		},
		{
			"id": "patient-marital-status",
			"sourcePath": "maritalStatus",
			"targetPath": "maritalStatus.coding[0].code",
			"dataType": "code",
			"lookupTable": "marital-status-lookup",
			"required": false
		},
		{
			"id": "patient-marital-status-system",
			"sourcePath": null,
			"targetPath": "maritalStatus.coding[0].system",
			"dataType": "uri",
			"defaultValue": "http://terminology.hl7.org/CodeSystem/v3-MaritalStatus",
			"condition": "maritalStatus != null",
			"required": false
		},
		{
			"id": "patient-deceased-boolean",
			"sourcePath": "demographics.deceasedFlag",
			"targetPath": "deceasedBoolean",
			"dataType": "boolean",
			"required": false
		},
		{
			"id": "patient-address-home-use",
			"sourcePath": "addresses[0].type",
			"targetPath": "address[0].use",
			"dataType": "code",
			"lookupTable": "address-use-lookup",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-address-home-line1",
			"sourcePath": "addresses[0].line1",
			"targetPath": "address[0].line[0]",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-address-home-line2",
			"sourcePath": "addresses[0].line2",
			"targetPath": "address[0].line[1]",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0 && addresses[0].line2 != null",
			"required": false
		},
		{
			"id": "patient-address-home-city",
			"sourcePath": "addresses[0].city",
			"targetPath": "address[0].city",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-address-home-state",
			"sourcePath": "addresses[0].state",
			"targetPath": "address[0].state",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-address-home-zip",
			"sourcePath": "addresses[0].zip",
			"targetPath": "address[0].postalCode",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-address-home-country",
			"sourcePath": "addresses[0].country",
			"targetPath": "address[0].country",
			"dataType": "string",
			"condition": "addresses != null && addresses.size() > 0",
			"required": false
		},
		{
			"id": "patient-telecom-mobile-system",
			"sourcePath": null,
			"targetPath": "telecom[0].system",
			"dataType": "code",
			"defaultValue": "phone",
			"condition": "contacts != null && contacts.size() > 0",
			"required": false
		},
		{
			"id": "patient-telecom-mobile-value",
			"sourcePath": "contacts[0].value",
			"targetPath": "telecom[0].value",
			"dataType": "string",
			"condition": "contacts != null && contacts.size() > 0",
			"required": false
		},
		{
			"id": "patient-telecom-mobile-use",
			"sourcePath": "contacts[0].type",
			"targetPath": "telecom[0].use",
			"dataType": "code",
			"lookupTable": "telecom-use-lookup",
			"condition": "contacts != null && contacts.size() > 0",
			"required": false
		},
		{
			"id": "patient-telecom-email-system",
			"sourcePath": null,
			"targetPath": "telecom[1].system",
			"dataType": "code",
			"defaultValue": "email",
			"condition": "contacts != null && contacts.size() > 2",
			"required": false
		},
		{
			"id": "patient-telecom-email-value",
			"sourcePath": "contacts[2].value",
			"targetPath": "telecom[1].value",
			"dataType": "string",
			"condition": "contacts != null && contacts.size() > 2",
			"required": false
		},
		{
			"id": "patient-language-code",
			"sourcePath": "preferredLanguage",
			"targetPath": "communication[0].language.coding[0].code",
			"dataType": "code",
			"lookupTable": "language-lookup",
			"condition": "preferredLanguage != null",
			"required": false
		},
		{
			"id": "patient-language-system",
			"sourcePath": null,
			"targetPath": "communication[0].language.coding[0].system",
			"dataType": "uri",
			"defaultValue": "urn:ietf:bcp:47",
			"condition": "preferredLanguage != null",
			"required": false
		},
		{
			"id": "patient-language-preferred",
			"sourcePath": null,
			"targetPath": "communication[0].preferred",
			"dataType": "boolean",
			"defaultValue": "true",
			"condition": "preferredLanguage != null",
			"required": false
		},
		{
			"id": "patient-race-ombCategory-code",
			"sourcePath": "race",
			"targetPath": "extension[0].extension[0].valueCoding.code",
			"dataType": "code",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-race-ombCategory-system",
			"sourcePath": null,
			"targetPath": "extension[0].extension[0].valueCoding.system",
			"dataType": "uri",
			"defaultValue": "urn:oid:2.16.840.1.113883.6.238",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-race-ombCategory-url",
			"sourcePath": null,
			"targetPath": "extension[0].extension[0].url",
			"dataType": "uri",
			"defaultValue": "ombCategory",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-race-text",
			"sourcePath": "race",
			"targetPath": "extension[0].extension[1].valueString",
			"dataType": "string",
			"lookupTable": "race-text-lookup",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-race-text-url",
			"sourcePath": null,
			"targetPath": "extension[0].extension[1].url",
			"dataType": "uri",
			"defaultValue": "text",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-race-url",
			"sourcePath": null,
			"targetPath": "extension[0].url",
			"dataType": "uri",
			"defaultValue": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-race",
			"condition": "race != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-ombCategory-code",
			"sourcePath": "ethnicity",
			"targetPath": "extension[1].extension[0].valueCoding.code",
			"dataType": "code",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-ombCategory-system",
			"sourcePath": null,
			"targetPath": "extension[1].extension[0].valueCoding.system",
			"dataType": "uri",
			"defaultValue": "urn:oid:2.16.840.1.113883.6.238",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-ombCategory-url",
			"sourcePath": null,
			"targetPath": "extension[1].extension[0].url",
			"dataType": "uri",
			"defaultValue": "ombCategory",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-text",
			"sourcePath": "ethnicity",
			"targetPath": "extension[1].extension[1].valueString",
			"dataType": "string",
			"lookupTable": "ethnicity-text-lookup",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-text-url",
			"sourcePath": null,
			"targetPath": "extension[1].extension[1].url",
			"dataType": "uri",
			"defaultValue": "text",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-ethnicity-url",
			"sourcePath": null,
			"targetPath": "extension[1].url",
			"dataType": "uri",
			"defaultValue": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity",
			"condition": "ethnicity != null",
			"required": false
		},
		{
			"id": "patient-birthsex-code",
			"sourcePath": "demographics.birthSex",
			"targetPath": "extension[2].valueCode",
			"dataType": "code",
			"lookupTable": "birth-sex-lookup",
			"condition": "demographics != null && demographics.birthSex != null",
			"required": false
		},
		{
			"id": "patient-birthsex-url",
			"sourcePath": null,
			"targetPath": "extension[2].url",
			"dataType": "uri",
			"defaultValue": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex",
			"condition": "demographics != null && demographics.birthSex != null",
			"required": false
		},
		{
			"id": "patient-managing-org",
			"sourcePath": null,
			"targetPath": "managingOrganization.reference",
			"dataType": "string",
			"transformExpression": "fn:concat('Organization/', $ctx.organizationId)",
			"condition": "$ctx.organizationId != null",
			"required": false
		}
	]
}